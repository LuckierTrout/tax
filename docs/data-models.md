# Data Models

## Overview

The application uses a single JSON file for persistence (`/data/taxonomy.json`). All type definitions are centralized in `/types/taxonomy.ts`.

## Storage Structure

```json
{
  "metadata": {
    "version": "1.0.0",
    "lastModified": "2026-01-30T10:00:00.000Z"
  },
  "settings": {
    "availableAudiences": ["..."],
    "availableGeographies": ["..."]
  },
  "nodes": [
    { "id": "...", "name": "...", ... }
  ]
}
```

---

## Core Types

### TaxonomyLevel

Union type representing the 5-level hierarchy.

```typescript
export type TaxonomyLevel =
  | 'pillar'
  | 'narrative_theme'
  | 'subject'
  | 'topic'
  | 'subtopic';
```

**Hierarchy Relationships:**
```
pillar (root)
  └── narrative_theme
        └── subject
              └── topic
                    └── subtopic (leaf)
```

---

### TaxonomyNode

Core data model for taxonomy items.

```typescript
export interface TaxonomyNode {
  // Identity
  id: string;                    // nanoid(10), e.g., "V1StGXR8_Z"

  // Content
  name: string;                  // Required, max 200 chars
  description?: string;          // Optional, max 1000 chars
  objective?: string;            // Only for pillar/narrative_theme/subject
  notes?: string;                // Internal notes, max 2000 chars

  // Categorization
  audiences?: string[];          // Selected from settings.availableAudiences
  geographies?: string[];        // Selected from settings.availableGeographies

  // Hierarchy
  parentId: string | null;       // null for pillars (root nodes)
  level: TaxonomyLevel;          // Determined by parent's level
  order: number;                 // Position among siblings (0-indexed)

  // Timestamps
  createdAt: string;             // ISO 8601 format
  updatedAt: string;             // ISO 8601 format
}
```

**Field Constraints:**

| Field | Required | Max Length | Notes |
|-------|----------|------------|-------|
| id | Yes | 10 chars | Generated by nanoid |
| name | Yes | 200 chars | - |
| description | No | 1000 chars | - |
| objective | No | 500 chars | Only levels 1-3 |
| notes | No | 2000 chars | Not shown in tree |
| audiences | No | - | Array of strings |
| geographies | No | - | Array of strings |
| parentId | Yes | - | null for pillars |
| level | Yes | - | Enum value |
| order | Yes | - | Integer >= 0 |
| createdAt | Yes | - | ISO timestamp |
| updatedAt | Yes | - | ISO timestamp |

---

### TaxonomySettings

Configuration for available categorization options.

```typescript
export interface TaxonomySettings {
  availableAudiences: string[];
  availableGeographies: string[];
}
```

**Default Values:**
```typescript
const DEFAULT_SETTINGS: TaxonomySettings = {
  availableAudiences: [
    'Internal Employees',
    'Executives',
    'Investors',
    'Media',
    'Customers',
    'Partners',
    'Government',
    'General Public',
  ],
  availableGeographies: [
    'Global',
    'North America',
    'Europe',
    'Asia Pacific',
    'Latin America',
    'Middle East & Africa',
  ],
};
```

---

### TaxonomyData

Complete data structure stored in JSON file.

```typescript
export interface TaxonomyData {
  nodes: TaxonomyNode[];
  settings: TaxonomySettings;
  metadata: {
    version: string;
    lastModified: string;
  };
}
```

---

### TreeNode

Extended node type with children array (for tree rendering).

```typescript
export interface TreeNode extends TaxonomyNode {
  children: TreeNode[];
}
```

**Usage:** Created by `buildTree()` function for hierarchical display.

---

## API Types

### CreateNodeRequest

```typescript
export interface CreateNodeRequest {
  name: string;
  description?: string;
  objective?: string;
  notes?: string;
  parentId: string | null;
}
```

### UpdateNodeRequest

```typescript
export interface UpdateNodeRequest {
  name?: string;
  description?: string;
  objective?: string;
  notes?: string;
  audiences?: string[];
  geographies?: string[];
}
```

### ReorderRequest

```typescript
export interface ReorderRequest {
  nodeId: string;
  newParentId?: string | null;
  newOrder: number;
}
```

---

## View State Types

### ViewMode

```typescript
export type ViewMode = 'tree' | 'column';
```

### ViewState

```typescript
export interface ViewState {
  mode: ViewMode;
  selectedPillarId: string | null;  // null = all pillars
  selectedNodeId: string | null;
  expandedNodeIds: Set<string>;
  searchTerm: string;
}
```

---

## Constants

### Levels with Objective Support

```typescript
export const LEVELS_WITH_OBJECTIVE: TaxonomyLevel[] = [
  'pillar',
  'narrative_theme',
  'subject'
];
```

Only these three levels can have objectives. Topic and Subtopic cannot.

---

## Level Configuration

**File:** `/config/levels.ts`

### LEVEL_HIERARCHY

Parent-child relationships.

```typescript
export const LEVEL_HIERARCHY: Record<TaxonomyLevel, TaxonomyLevel | null> = {
  pillar: null,              // No parent
  narrative_theme: 'pillar',
  subject: 'narrative_theme',
  topic: 'subject',
  subtopic: 'topic',
};
```

### LEVEL_CHILDREN

Child level lookup.

```typescript
export const LEVEL_CHILDREN: Record<TaxonomyLevel, TaxonomyLevel | null> = {
  pillar: 'narrative_theme',
  narrative_theme: 'subject',
  subject: 'topic',
  topic: 'subtopic',
  subtopic: null,            // Cannot have children
};
```

### LEVEL_LABELS

Display names.

```typescript
export const LEVEL_LABELS: Record<TaxonomyLevel, string> = {
  pillar: 'Pillar',
  narrative_theme: 'Narrative Theme',
  subject: 'Subject',
  topic: 'Topic',
  subtopic: 'Subtopic',
};
```

### LEVEL_COLORS

Tailwind CSS classes per level.

```typescript
export const LEVEL_COLORS: Record<TaxonomyLevel, {
  bg: string;
  border: string;
  text: string;
  dot: string;
}> = {
  pillar: {
    bg: 'bg-purple-50',
    border: 'border-purple-400',
    text: 'text-purple-900',
    dot: 'bg-purple-500',
  },
  narrative_theme: {
    bg: 'bg-blue-50',
    border: 'border-blue-400',
    text: 'text-blue-900',
    dot: 'bg-blue-500',
  },
  subject: {
    bg: 'bg-green-50',
    border: 'border-green-400',
    text: 'text-green-900',
    dot: 'bg-green-500',
  },
  topic: {
    bg: 'bg-yellow-50',
    border: 'border-yellow-400',
    text: 'text-yellow-900',
    dot: 'bg-yellow-500',
  },
  subtopic: {
    bg: 'bg-orange-50',
    border: 'border-orange-400',
    text: 'text-orange-900',
    dot: 'bg-orange-500',
  },
};
```

### LEVEL_ORDER

Array for iteration.

```typescript
export const LEVEL_ORDER: TaxonomyLevel[] = [
  'pillar',
  'narrative_theme',
  'subject',
  'topic',
  'subtopic',
];
```

---

## Data Relationships

```
┌─────────────────────────────────────────────────────────┐
│                    TaxonomyData                          │
├─────────────────────────────────────────────────────────┤
│  metadata                                                │
│    ├── version: "1.0.0"                                 │
│    └── lastModified: ISO timestamp                      │
│                                                          │
│  settings                                                │
│    ├── availableAudiences: string[]                     │
│    └── availableGeographies: string[]                   │
│                                                          │
│  nodes[]                                                 │
│    └── TaxonomyNode                                     │
│          ├── id ─────────────┐                          │
│          ├── parentId ───────┼──► References other node │
│          ├── level ──────────┼──► From TaxonomyLevel    │
│          ├── audiences[] ────┼──► From settings         │
│          └── geographies[] ──┴──► From settings         │
└─────────────────────────────────────────────────────────┘
```

---
*Generated by BMAD Document Project Workflow v1.2.0*
